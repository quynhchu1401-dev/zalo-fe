"use strict";(self["webpackChunkzalo_fe"]=self["webpackChunkzalo_fe"]||[]).push([[922],{7922:function(e,l,i){i.r(l),i.d(l,{default:function(){return Q}});i(3725),i(5019),i(2598),i(1339),i(9229);var a=i(641),n=i(953),t=i(33),c=i(3080),s=i(5094),o=i(8590),u=i(7164);const d=e=>((0,a.Qi)("data-v-4136a66a"),e=e(),(0,a.jt)(),e),r={class:"menu-page"},h={class:"toolbar"},p={class:"actions"},m={class:"p-input-icon-left search"},v=d((()=>(0,a.Lk)("i",{class:"pi pi-search"},null,-1))),b={class:"list"},k={class:"parent-row"},f={class:"col-name"},y={class:"col-status"},L={class:"col-actions"},g={key:0,class:"child-list"},C={class:"actions"},w={key:1,class:"no-children"},V={class:"dialog-form"},F={class:"form-row"},R=d((()=>(0,a.Lk)("label",null,[(0,a.eW)("Tên hiển thị "),(0,a.Lk)("span",{class:"required"},"*")],-1))),A={class:"form-row"},I=d((()=>(0,a.Lk)("label",null,"Icon (PrimeIcons)",-1))),K={class:"form-row"},T=d((()=>(0,a.Lk)("label",null,"Route (to)",-1))),E={class:"form-row"},X=d((()=>(0,a.Lk)("label",null,"Loại",-1))),x={key:0,class:"form-row"},_=d((()=>(0,a.Lk)("label",null,[(0,a.eW)("Menu cha "),(0,a.Lk)("span",{class:"required"},"*")],-1))),M={class:"form-row switch-row"},U=d((()=>(0,a.Lk)("label",null,"Hiển thị",-1))),W={class:"form-actions"};var j=(0,a.pM)({setup(e){const l=(0,c.d)(),i=(0,s.S)(),d=[{label:"Menu cha",value:"parent"},{label:"Menu con",value:"child"}],j=(0,n.KR)(""),H=(0,n.KR)(!1),S=(0,n.KR)(!1),Q=(0,n.Kh)({id:"",label:"",icon:"",to:"",type:"parent",parentId:null,isActive:!0}),q=(0,n.EW)((()=>u.K$.value.admin||[])),D=(0,n.EW)((()=>q.value.map((e=>({label:e.label,value:e.id}))))),$=(0,n.EW)((()=>q.value.length>0)),N=(0,n.EW)((()=>{const e=(j.value||"").toLowerCase().trim();return e?q.value.filter((l=>(l.label||"").toLowerCase().includes(e)||(l.children||[]).some((l=>(l.label||"").toLowerCase().includes(e))))):q.value})),z=e=>`${e}_${Date.now()}_${Math.random().toString(16).slice(2)}`;function B(e){return q.value.find((l=>(l.children||[]).some((l=>l.id===e))))||null}function O(e){const l=q.value.find((l=>l.id===e));if(l)return{parent:null,item:l};for(const i of q.value){const l=(i.children||[]).find((l=>l.id===e));if(l)return{parent:i,item:l}}return{parent:null,item:null}}const P=async()=>{try{await(0,u.wE)()}catch(e){l.add({severity:"error",summary:"Lỗi",detail:e?.message||"Không thể tải menu từ server",life:2500})}},G=async()=>{try{await(0,u.FS)(),l.add({severity:"success",summary:"Lưu",detail:"Đã lưu vào menu.json",life:1200})}catch(e){l.add({severity:"error",summary:"Lỗi",detail:e?.message||"Không thể lưu vào menu.json",life:2500})}},J=(e,l)=>{S.value=!1,Q.id="",Q.label="parent"===e?"Menu cha mới":"Menu con mới",Q.icon="",Q.to="",Q.type=e,Q.parentId="child"===e&&(l||D.value[0]?.value)||null,Q.isActive=!0,H.value=!0},Y=(e,l)=>{S.value=!0,Q.id=e.id,Q.label=e.label||"",Q.icon=e.icon||"",Q.to=e.to||"",Q.type=l?"child":"parent",Q.parentId=l||null,Q.isActive=!1!==e.isActive,H.value=!0},Z=async()=>{const e=(Q.label||"").trim();if(e)if("child"!==Q.type||Q.parentId){if(S.value){const i=O(Q.id);if(!i.item)return void l.add({severity:"warn",summary:"Không tìm thấy",detail:"Không tìm thấy item để sửa",life:1500});if("child"===Q.type&&Q.parentId){const i=B(Q.id),a=q.value.find((e=>e.id===Q.parentId))||null;if(!a)return void l.add({severity:"warn",summary:"Thiếu dữ liệu",detail:"Menu cha không hợp lệ",life:1500});i?.children&&(i.children=i.children.filter((e=>e.id!==Q.id))),a.children||(a.children=[]),a.children.push({id:Q.id,label:e,icon:Q.icon||"",to:Q.to||"",isActive:Q.isActive})}else Object.assign(i.item,{label:e,icon:Q.icon||"",to:Q.to||"",isActive:Q.isActive})}else if("parent"===Q.type)q.value.push({id:z("p"),label:e,icon:Q.icon||"",to:Q.to||"",isActive:Q.isActive,children:[]});else{const i=q.value.find((e=>e.id===Q.parentId));if(!i)return void l.add({severity:"warn",summary:"Thiếu dữ liệu",detail:"Menu cha không hợp lệ",life:1500});i.children||(i.children=[]),i.children.push({id:z("c"),label:e,icon:Q.icon||"",to:Q.to||"",isActive:Q.isActive})}H.value=!1,await G()}else l.add({severity:"warn",summary:"Thiếu dữ liệu",detail:"Menu con phải chọn menu cha",life:1500});else l.add({severity:"warn",summary:"Thiếu dữ liệu",detail:"Tên hiển thị không được để trống",life:1500})},ee=e=>{i.require({header:"Xác nhận xoá",icon:"pi pi-exclamation-triangle",message:"Bạn chắc chắn muốn xoá? Nếu là menu cha sẽ xoá luôn các menu con.",acceptLabel:"Xoá",rejectLabel:"Huỷ",accept:async()=>{le(e),await G(),l.add({severity:"success",summary:"Thành công",detail:"Đã xóa menu",life:1200})}})},le=e=>{const l=q.value.findIndex((l=>l.id===e));if(l>=0)q.value.splice(l,1);else for(const i of q.value)i.children?.length&&(i.children=i.children.filter((l=>l.id!==e)))},ie=()=>{i.require({header:"Xác nhận khôi phục",icon:"pi pi-refresh",message:"Khôi phục menu về mặc định? Sẽ mất cấu hình đang chỉnh.",acceptLabel:"Khôi phục",rejectLabel:"Huỷ",accept:async()=>{try{await P(),l.add({severity:"success",summary:"Thành công",detail:"Đã khôi phục",life:1200})}catch(e){l.add({severity:"error",summary:"Lỗi",detail:e?.message||"Không thể khôi phục",life:2500})}}})};return(0,a.sV)((async()=>{await P()})),(e,l)=>{const i=(0,a.g2)("Button"),c=(0,a.g2)("InputText"),s=(0,a.g2)("ConfirmDialog"),u=(0,a.g2)("Dropdown"),S=(0,a.g2)("InputSwitch"),q=(0,a.g2)("Dialog");return(0,a.uX)(),(0,a.Wv)(o.A,{title:"Quản lý danh mục menu"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",r,[(0,a.Lk)("div",h,[(0,a.Lk)("div",p,[(0,a.bF)(i,{class:"btn-primary",icon:"pi pi-plus",label:"Thêm menu cha",onClick:l[0]||(l[0]=e=>J("parent"))}),(0,a.bF)(i,{class:"btn-primary",icon:"pi pi-plus-circle",label:"Thêm menu con",disabled:!(0,n.R1)($),onClick:l[1]||(l[1]=e=>J("child"))},null,8,["disabled"]),(0,a.bF)(i,{class:"btn-outline",icon:"pi pi-save",label:"Lưu cấu hình",onClick:G}),(0,a.bF)(i,{class:"btn-outline",icon:"pi pi-refresh",label:"Khôi phục mặc định",onClick:ie})]),(0,a.Lk)("span",m,[v,(0,a.bF)(c,{modelValue:j.value,"onUpdate:modelValue":l[2]||(l[2]=e=>j.value=e),placeholder:"Tìm menu..."},null,8,["modelValue"])])]),(0,a.Lk)("div",b,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,n.R1)(N),(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"parent-item"},[(0,a.Lk)("div",k,[(0,a.Lk)("div",f,[e.icon?((0,a.uX)(),(0,a.CE)("i",{key:0,class:(0,t.C4)(e.icon)},null,2)):(0,a.Q3)("",!0),(0,a.Lk)("strong",null,(0,t.v_)(e.label),1)]),(0,a.Lk)("div",y,[(0,a.Lk)("span",{class:(0,t.C4)(["badge",{off:!1===e.isActive}])},(0,t.v_)(!1===e.isActive?"ẨN":"HIỂN THỊ"),3)]),(0,a.Lk)("div",L,[(0,a.bF)(i,{class:"p-button-text p-button-sm",label:"Sửa",onClick:l=>Y(e)},null,8,["onClick"]),(0,a.bF)(i,{class:"p-button-text p-button-sm",label:"Thêm con",onClick:l=>J("child",e.id)},null,8,["onClick"]),(0,a.bF)(i,{class:"p-button-text p-button-danger p-button-sm",label:"Xóa",onClick:l=>ee(e.id)},null,8,["onClick"])])]),e.children&&e.children.length?((0,a.uX)(),(0,a.CE)("ul",g,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.children,(l=>((0,a.uX)(),(0,a.CE)("li",{key:l.id},[(0,a.Lk)("span",null,[l.icon?((0,a.uX)(),(0,a.CE)("i",{key:0,class:(0,t.C4)(l.icon)},null,2)):(0,a.Q3)("",!0),(0,a.eW)(" "+(0,t.v_)(l.label),1)]),(0,a.Lk)("div",C,[(0,a.bF)(i,{class:"p-button-text p-button-sm",icon:"pi pi-pencil",onClick:i=>Y(l,e.id)},null,8,["onClick"]),(0,a.bF)(i,{class:"p-button-text p-button-danger p-button-sm",icon:"pi pi-trash",onClick:e=>ee(l.id)},null,8,["onClick"])])])))),128))])):((0,a.uX)(),(0,a.CE)("div",w,"Chưa có menu con"))])))),128))]),(0,a.bF)(s),(0,a.bF)(q,{header:"Thêm / Chỉnh sửa menu",visible:H.value,"onUpdate:visible":l[10]||(l[10]=e=>H.value=e),modal:!0,style:{width:"500px"}},{default:(0,a.k6)((()=>[(0,a.Lk)("div",V,[(0,a.Lk)("div",F,[R,(0,a.bF)(c,{modelValue:(0,n.R1)(Q).label,"onUpdate:modelValue":l[3]||(l[3]=e=>(0,n.R1)(Q).label=e)},null,8,["modelValue"])]),(0,a.Lk)("div",A,[I,(0,a.bF)(c,{modelValue:(0,n.R1)(Q).icon,"onUpdate:modelValue":l[4]||(l[4]=e=>(0,n.R1)(Q).icon=e),placeholder:"vd: pi pi-home"},null,8,["modelValue"])]),(0,a.Lk)("div",K,[T,(0,a.bF)(c,{modelValue:(0,n.R1)(Q).to,"onUpdate:modelValue":l[5]||(l[5]=e=>(0,n.R1)(Q).to=e),placeholder:"vd: /sendmessage"},null,8,["modelValue"])]),(0,a.Lk)("div",E,[X,(0,a.bF)(u,{modelValue:(0,n.R1)(Q).type,"onUpdate:modelValue":l[6]||(l[6]=e=>(0,n.R1)(Q).type=e),options:d,optionLabel:"label",optionValue:"value"},null,8,["modelValue"])]),"child"===(0,n.R1)(Q).type?((0,a.uX)(),(0,a.CE)("div",x,[_,(0,a.bF)(u,{modelValue:(0,n.R1)(Q).parentId,"onUpdate:modelValue":l[7]||(l[7]=e=>(0,n.R1)(Q).parentId=e),options:(0,n.R1)(D),optionLabel:"label",optionValue:"value",placeholder:"Chọn menu cha"},null,8,["modelValue","options"])])):(0,a.Q3)("",!0),(0,a.Lk)("div",M,[U,(0,a.bF)(S,{modelValue:(0,n.R1)(Q).isActive,"onUpdate:modelValue":l[8]||(l[8]=e=>(0,n.R1)(Q).isActive=e)},null,8,["modelValue"])]),(0,a.Lk)("div",W,[(0,a.bF)(i,{class:"btn-primary",icon:"pi pi-check",label:"Lưu",onClick:Z}),(0,a.bF)(i,{class:"btn-outline",icon:"pi pi-times",label:"Huỷ",onClick:l[9]||(l[9]=e=>H.value=!1)})])])])),_:1},8,["visible"])])])),_:1})}}}),H=i(6262);const S=(0,H.A)(j,[["__scopeId","data-v-4136a66a"]]);var Q=S}}]);
//# sourceMappingURL=922.ca062dfb.js.map